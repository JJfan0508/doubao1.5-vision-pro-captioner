# ComfyUI 豆包图像分析节点

这是一个用于ComfyUI的自定义节点，通过字节跳动的豆包1.5 vision pro模型将图像转换为文字描述。此节点专为中文用户设计，可以帮助您从图像中提取详细文字描述，用于创意工作流、图像标注或者AI图像生成的提示词提炼。

## 功能特点

- 接入豆包1.5 vision pro视觉语言模型
- 支持三种图像理解深度模式：high、low、auto
- 自定义提示词，引导AI根据特定需求分析图像
- 详细的日志记录，方便调试和了解API调用过程
- 简洁的界面，专注于单一功能的高质量实现

## 安装步骤

1. 确保你已经安装了ComfyUI
2. 将此仓库克隆或下载到ComfyUI的`custom_nodes`目录下：
   ```
   cd ComfyUI/custom_nodes
   git clone https://github.com/yourusername/ComfyUI_doubao_vision.git
   ```
3. 安装必要的依赖：
   ```
   pip install -r requirements.txt
   ```
4. 重启ComfyUI

## 使用方法

1. 在ComfyUI工作流中添加 "豆包图像分析" 节点（搜索"豆包"或"DoubaoVision"）
2. 设置以下参数：
   - `image`: 连接要分析的图像输出
   - `detail_level`: 选择图像理解深度模式（high/low/auto）
   - `api_url`: 豆包API端点URL（默认已设置）
   - `api_key`: 输入你的豆包API密钥
   - `custom_prompt`: 自定义提示词，引导AI分析图像

3. 节点的输出是一个字符串，包含AI对图像的详细描述

## 参数详解

- **image**: 输入图像，可以是任何ComfyUI中的图像输出
- **detail_level**: 图像理解深度模式
  - `high`: 高精度模式，提供最详细的分析（适合需要精确识别的场景）
  - `low`: 低精度模式，处理速度更快（适合一般描述场景）
  - `auto`: 自动模式，由API自动选择适合的精度
- **api_url**: 豆包API的URL地址（默认为：https://ark.cn-beijing.volces.com/api/v3/chat/completions）
- **api_key**: 访问豆包API所需的密钥
- **custom_prompt**: 自定义提示词，用于指导模型如何分析图像

## 图像理解深度模式说明

豆包1.5 vision pro模型提供三种图像理解深度模式：

1. **high模式**: 提供最详细的图像分析，识别更多细节，适合需要精确描述的场景。处理时间可能较长。
2. **low模式**: 提供基本图像分析，处理速度更快，适合只需要基本描述的场景。
3. **auto模式**: 由API自动决定使用哪种精度，平衡精度和速度。

## 实际应用场景

- **图像标注**: 自动生成图像描述，节省手动标注时间
- **提示词提炼**: 从参考图像中提取关键词，用于AI生成类似风格或内容的图像
- **内容审核**: 分析图像内容，判断是否包含敏感元素
- **创意写作辅助**: 根据图像生成文字描述，作为创意写作的起点
- **多模态应用**: 将图像信息转换为文本，用于多模态应用开发

## 工作流示例

### 基本图像分析工作流

1. **加载图像节点** → 加载要分析的图像
2. **豆包图像分析节点** → 分析图像并提取描述
   - `detail_level` 设置为 "high" 获取最详细的描述
   - `custom_prompt` 设置为 "详细描述这张图片的场景、主体、风格特点和细节"
3. **文本显示或保存节点** → 显示或保存生成的描述

### 图像到图像工作流

1. **加载参考图像节点** → 加载参考图像
2. **豆包图像分析节点** → 分析图像并提取描述
   - `detail_level` 设置为 "high"
   - `custom_prompt` 设置为 "提取这张图片的关键元素和风格特点，以逗号分隔"
3. **提示词处理节点** → 对提取的描述进行处理
4. **文生图节点** → 使用处理后的描述生成新图像

## 获取豆包API密钥

要使用此节点，您需要获取豆包API的密钥：

1. 访问[字节豆包官网](https://www.volcengine.com/product/doubao)
2. 注册并开通豆包API服务
3. 创建API密钥并获取授权令牌
4. 将获取的API密钥填入节点的`api_key`字段

## 注意事项

- 请确保你有权访问豆包API并拥有有效的API密钥
- 留意API调用的计费情况，合理控制使用频率
- 图像分析结果的质量取决于输入图像的清晰度和复杂度
- 高清晰度的图像在`high`模式下可能需要更长的处理时间
- 模型可能无法识别过于专业或特定领域的细节

## 常见问题排查

- **找不到节点**: 确保在ComfyUI中搜索"豆包"或"DoubaoVision"
- **API调用失败**: 检查API密钥是否正确，URL是否可访问
- **结果不准确**: 尝试调整custom_prompt来引导模型关注特定方面
- **处理时间过长**: 对于一般描述，尝试使用`low`模式加快处理速度

## 贡献指南

欢迎为此项目做出贡献！您可以通过以下方式参与：

1. 提交bug报告或功能请求
2. 改进代码或文档
3. 分享使用案例和工作流示例

## 许可证

本项目采用MIT许可证 - 详见LICENSE文件 